# spring boot rabbitmq 接收消息时异常死循环

liaoyuecai 最后发布于2018-04-18 10:39:27

spring boot rabbitmq的使用很方便,只需要两个注解即可实现,这里就不赘述了,网上有很多资料

不过在使用时,我发现有些情况与我看的一些资料有出入

如果在发送消息时,调用的是AmqpTemplate.convertAndSend("",Object),那么你就需要增加一个配置做Json转换,不然在接收时消息异常,然后消息无法被消费,一直消费会造成死循环,具体配置可以看官方资料,因为我用String传输的,所以没有写这个配置

我看网上的资料都是说需要配置消费手动确认,不然出现异常的消息将会被丢弃,但实际上并不是这样,我这边的版本是1.5.10

**实际上在@RabbitHandler注解的方法中抛出任何异常,都会造成当条消息无法被消费,下一次仍然消费上一条异常的消息,而如果每次消费这条消息都抛出了异常,那么这条消息的消费将会进入死循环**

在方法内加入try catch即可避免此种状况

还有一种情况是try catch没有捕获到异常也会进入死循环的

我因为业务需要在接收消息的类里面注入了一个service,然后接收方法调用了service的方法,在这个service方法中有一个try catch,没有将异常抛出,然后有一次我发现service方法报错了,@RabbitHandler一直在消费同一条消息,显然也是进入了死循环

这种情况将捕获到的异常抛出即可

 



原文链接：https://blog.csdn.net/liaoyuecai/article/details/79985155

